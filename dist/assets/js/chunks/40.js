"use strict";(self.webpackChunksg_blocks=self.webpackChunksg_blocks||[]).push([[40],{5856:(e,t,n)=>{n.d(t,{Z:()=>u});var r=n(9818),o=n(9196);function l(e,t,n){var r;return r=function(e,t){if("object"!=a(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=a(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(t),(t="symbol"==a(r)?r:String(r))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}const u=function(e,t,n){var u,c,s=(0,r.useSelect)((function(e){return e("core/editor").getEditedPostAttribute("meta")}),[e,t]),d=(u=(0,o.useState)(s[n]),c=2,function(e){if(Array.isArray(e))return e}(u)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,l,a,i=[],u=!0,c=!1;try{if(l=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=l.call(n)).done)&&(i.push(r.value),i.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return i}}(u,c)||function(e,t){if(e){if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}(u,c)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),f=d[0],m=d[1],p=(0,o.useMemo)((function(){return function(e,t){if(e===t)return!0;if("object"!==a(e)||null===e||"object"!==a(t)||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(var o=0,l=n;o<l.length;o++){var i=l[o];if(!r.includes(i)||!p(e[i],t[i]))return!1}return!0}}),[]);return(0,o.useEffect)((function(){p(f,s[n])||m(s[n])}),[s]),[f,function(o){m(o),(0,r.dispatch)("core").editEntityRecord("postType",e,t,{meta:l({},n,o)}).catch((function(e){console.error(e),m(s[n])}))}]}},6040:(e,t,n)=>{n.r(t),n.d(t,{default:()=>S});var r=n(9196),o=n.n(r),l=n(2175),a=n(5609),i=n(9818),u=n(9153),c=n(5715),s=n(195),d=n(577),f=n(2604),m=n(4225),p=(n(3074),n(5736)),g=n(5243),v=n.n(g),b=n(5856);function y(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,l,a,i=[],u=!0,c=!1;try{if(l=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=l.call(n)).done)&&(i.push(r.value),i.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var E=new(v().Icon)({iconUrl:"/wp-content/plugins/sg-blocks/dist/blocks/map/icons/marker-icon.png",shadowUrl:"/wp-content/plugins/sg-blocks/dist/blocks/map/icons/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28]});const S=function(e){var t,n,g=e.attributes,v=e.setAttributes,h=g.className,S=g.id,k=g.meta_meeting_point,_=(0,i.select)("core/editor").getEditedPostAttribute("id"),A=(0,i.select)("core/editor").getEditedPostAttribute("type"),C=y((0,b.Z)(A,_,"meeting_point"),2),w=C[0],x=C[1],j=y((0,r.useState)(k?null==w?void 0:w.lat:null==g?void 0:g.lat),2),F=j[0],z=j[1],L=y((0,r.useState)(k?null==w?void 0:w.lng:null==g?void 0:g.lng),2),P=L[0],O=L[1],N=y((0,r.useState)(k?null==w?void 0:w.zoom:null==g?void 0:g.zoom),2),I=N[0],T=N[1],Z=y((0,r.useState)(k?null==w?void 0:w.address:null==g?void 0:g.address),2),M=Z[0],U=Z[1];(0,r.useEffect)((function(){k?x({address:M,lat:F,lng:P,zoom:I}):v({address:M,lat:F,lng:P,zoom:I})}),[M,F,P,I]),(0,r.useEffect)((function(){k&&(F!==(null==w?void 0:w.lat)&&z(null==w?void 0:w.lat),P!==(null==w?void 0:w.lng)&&O(null==w?void 0:w.lng),I!==(null==w?void 0:w.zoom)&&T(null==w?void 0:w.zoom),M!==(null==w?void 0:w.address)&&U(null==w?void 0:w.address))}),[w]);var B=(0,r.useRef)(null),R=(0,r.useMemo)((function(){return new m.Zm}),[]);(0,r.useEffect)((function(){!0===k&&(v({id:void 0,address:void 0,lat:void 0,lng:void 0,zoom:void 0}),U(null==w?void 0:w.address),z(null==w?void 0:w.lat),O(null==w?void 0:w.lng),T(null==w?void 0:w.zoom)),S||k||v({id:"sg-map-"+Math.random().toString(36).substring(2,9)})}),[k]),(0,r.useEffect)((function(){B.current&&B.current.openPopup()}),[B.current]);var $=(0,l.useBlockProps)();$.className=$.className.replace(g.className,"");var q=function(e){var t=e.lat,n=e.lng,r=e.zoom,o=B.current;null!=o&&o.openPopup();var l=(0,u.zV)({dragend:function(){null!=o&&(z(parseFloat(o.getLatLng().lat.toFixed(7))),O(parseFloat(o.getLatLng().lng.toFixed(7))),o.openPopup())},drag:function(){null!=o&&(o.closePopup(),o.setLatLng([parseFloat(l.getCenter().lat.toFixed(7)),parseFloat(l.getCenter().lng.toFixed(7))]))},zoomend:function(){T(l.getZoom()),null!==o&&o.openPopup()}});return t&&n&&r&&l.flyTo([t,n],r),null};return o().createElement(o().Fragment,null,o().createElement(l.InspectorControls,null,o().createElement(a.PanelBody,{title:"Options"},o().createElement(a.ToggleControl,{label:(0,p.__)("Configurer le point de rendez vous de l'activité","sg-blocks"),checked:k,onChange:function(e){return v({meta_meeting_point:e})}}),o().createElement(a.TextControl,{label:(0,p.__)("Saisie Adresse","sg-blocks"),value:null!=M?M:"",onChange:function(e){return U(e)}}),o().createElement(a.Button,{icon:"search",onClick:function(){R.search({query:null!=M?M:""}).then((function(e){if(e.length>0){var t=parseFloat(e[0].y.toFixed(7)),n=parseFloat(e[0].x.toFixed(7));z(t),O(n),T(14)}}))}},"Rechercher les coordonnées de l'adresse"),o().createElement(a.__experimentalNumberControl,{label:(0,p.__)("Latitude","sg-blocks"),value:F,onChange:function(e){return z(e?parseFloat((+e).toFixed(7)):void 0)}}),o().createElement(a.__experimentalNumberControl,{label:(0,p.__)("Longitude","sg-blocks"),value:P,onChange:function(e){return O(e?parseFloat((+e).toFixed(7)):void 0)}}),o().createElement(a.__experimentalNumberControl,{label:(0,p.__)("Zoom","sg-blocks"),value:I,spinControls:"custom",min:1,step:1,max:20,onChange:function(e){return T(e)}}))),o().createElement("div",$,o().createElement("div",{className:"".concat(h?" "+h:"")},o().createElement(c.h,{center:{lat:null!=F?F:48.6,lng:null!=P?P:2.3},zoom:null!=I?I:5,scrollWheelZoom:!1},o().createElement(q,{lat:F,lng:P,zoom:I}),o().createElement(s.I,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),F&&P&&o().createElement(d.J,{position:{lat:null!=F?F:48.6,lng:null!=P?P:2.3},icon:E,ref:B},M&&o().createElement(f.G,{className:"color-primary"},o().createElement("span",{className:"color-primary f-s"},M),o().createElement("br",null),o().createElement("span",{className:"f-xxs color-grey-2 marker-coordinates"},"Lat: ".concat(null===(t=B.current)||void 0===t?void 0:t.getLatLng().lat,", Lng: ").concat(null===(n=B.current)||void 0===n?void 0:n.getLatLng().lng))))))))}}}]);